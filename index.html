<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BJVid√©o - IPTV Pro Control</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;800&display=swap" rel="stylesheet">
    <style>
        :root { --neon-red: #ff0000; --bg-dark: #0a0a0a; --nav-h: 65px; --transition: 0.3s ease; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg-dark); color: white; margin: 0; overflow-x: hidden; }
        
        /* NAVIGATION */
        nav { position: fixed; top: 0; width: 100%; height: var(--nav-h); display: flex; align-items: center; padding: 0 4%; background: #000; z-index: 2000; border-bottom: 1px solid #1a1a1a; }
        .logo { color: var(--neon-red); font-size: 22px; font-weight: 800; text-decoration: none; }
        .nav-menu { display: flex; gap: 10px; margin-left: auto; align-items: center; }
        .nav-btn { background: #1a1a1a; border: 1px solid #333; color: white; padding: 6px 12px; border-radius: 20px; cursor: pointer; font-size: 14px; }
        .nav-btn:hover { background: var(--neon-red); }

        /* LECTEUR DOUBLE MODE */
        .player-container { margin-top: var(--nav-h); width: 100%; transition: var(--transition); background: #000; position: relative; }
        .mode-full { height: 65vh; }
        .mode-mini { height: 200px; width: 350px; position: fixed; bottom: 20px; right: 20px; z-index: 3000; border: 2px solid var(--neon-red); border-radius: 15px; box-shadow: 0 0 30px #000; }
        video { width: 100%; height: 100%; object-fit: contain; }
        
        .toggle-view { position: absolute; top: 10px; right: 10px; z-index: 100; background: rgba(0,0,0,0.6); border: 1px solid white; color: white; border-radius: 50%; width: 35px; height: 35px; cursor: pointer; }

        /* CATEGORIES & FILTRES */
        .filter-bar { padding: 15px 4%; background: #111; display: flex; gap: 10px; overflow-x: auto; white-space: nowrap; border-bottom: 1px solid #222; }
        .search-box { width: 92%; margin: 10px 4%; padding: 12px; background: #1a1a1a; border: 1px solid #333; color: white; border-radius: 10px; }

        /* GRILLE */
        .content-section { padding: 10px 4% 100px; }
        .group-title { font-size: 18px; margin: 20px 0 10px; border-left: 4px solid var(--neon-red); padding-left: 10px; text-transform: uppercase; }
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; }
        .card { background: #151515; border-radius: 10px; overflow: hidden; border: 1px solid #222; cursor: pointer; transition: 0.2s; position: relative; }
        .card:hover { border-color: var(--neon-red); transform: scale(1.03); }
        .card img { width: 100%; height: 80px; object-fit: contain; background: #000; padding: 10px; box-sizing: border-box; }
        .card p { font-size: 11px; text-align: center; margin: 8px 0; font-weight: 600; }

        /* ADMIN STYLE */
        .panel { display: none; padding: 80px 4%; }
        .box { background: #111; padding: 20px; border-radius: 15px; border: 1px solid #222; margin-bottom: 20px; }
        input, select { width: 100%; padding: 10px; margin: 5px 0; background: #000; border: 1px solid #333; color: white; border-radius: 5px; }
        .admin-item { display: flex; justify-content: space-between; align-items: center; background: #000; padding: 10px; margin: 5px 0; border-radius: 5px; font-size: 12px; border: 1px solid #222; }
        .btn-move { background: none; color: #555; border: none; cursor: pointer; font-size: 18px; }
        .btn-move:hover { color: var(--neon-red); }

        #profile-selector { position: fixed; inset: 0; background: #000; z-index: 10000; display: flex; flex-direction: column; justify-content: center; align-items: center; }

        @media (max-width: 768px) {
            .grid { grid-template-columns: repeat(3, 1fr); gap: 8px; }
            .mode-mini { width: 180px; height: 110px; }
        }
    </style>
</head>
<body>

<div id="profile-selector">
    <h1 style="color:var(--neon-red)">BJVid√©o</h1>
    <div id="profile-list" style="display:flex; gap:20px;"></div>
</div>

<nav>
    <a href="#" class="logo" onclick="location.reload()">BJVid√©o</a>
    <div class="nav-menu">
        <button class="nav-btn" onclick="showPage('home')">üè†</button>
        <button class="nav-btn" onclick="showPage('account')">üë§</button>
        <button id="admin-link" class="nav-btn" style="display:none;" onclick="showPage('admin')">‚öôÔ∏è Admin</button>
    </div>
</nav>

<div id="page-home">
    <div id="player-wrap" class="player-container mode-full">
        <button class="toggle-view" onclick="toggleView()">üñ•Ô∏è</button>
        <video id="video-player" controls playsinline></video>
    </div>

    <input type="text" id="search" class="search-box" placeholder="Rechercher une cha√Æne ou un film..." onkeyup="render()">

    <div class="filter-bar" id="folder-filters">
        </div>

    <div id="main-content" class="content-section">
        </div>
</div>

<div id="page-account" class="panel">
    <div class="box">
        <h3>Mon Compte</h3>
        <p id="user-info"></p>
        <input type="password" id="new-p" placeholder="Nouveau mot de passe">
        <button class="nav-btn" style="width:100%" onclick="updateP()">Enregistrer</button>
    </div>
</div>

<div id="page-admin" class="panel">
    <div class="box" style="border-color: var(--neon-red);">
        <h3>üìÅ Gestion des Dossiers (Bouquets)</h3>
        <input type="text" id="folder-name" placeholder="Nom du dossier (ex: CANAL+)">
        <button class="nav-btn" onclick="addFolder()">Cr√©er le dossier</button>
        <div id="admin-folders" style="margin-top:10px;"></div>
    </div>

    <div class="box">
        <h3>üì∫ Ajouter une Cha√Æne / Film</h3>
        <input type="text" id="c-name" placeholder="Nom">
        <input type="text" id="c-url" placeholder="Lien flux (m3u8)">
        <input type="text" id="c-logo" placeholder="URL Logo">
        <select id="c-folder"></select>
        <select id="c-type">
            <option value="tv">TV en Direct</option>
            <option value="movie">Film</option>
            <option value="serie">S√©rie</option>
            <option value="music">Musique</option>
        </select>
        <button class="nav-btn" style="width:100%" onclick="addChannel()">Ajouter au catalogue</button>
    </div>

    <div class="box">
        <h3>üìë Organiser le Catalogue</h3>
        <div id="admin-channels-list"></div>
    </div>
</div>

<script>
    const defAccs = [
        { name: 'Admin', mdp: 'Treza670', role: 'admin', color: '#ff0000' },
        { name: 'Gauthier', mdp: 'gauthierrauch67', role: 'user', color: '#2ecc71' }
    ];

    let db_accs = JSON.parse(localStorage.getItem('bj_accs')) || defAccs;
    let db_lib = JSON.parse(localStorage.getItem('bj_lib')) || [];
    let db_folders = JSON.parse(localStorage.getItem('bj_folders')) || ["TNT", "FILMS", "S√âRIES"];
    let user = null;
    const player = document.getElementById('video-player');
    const hls = new Hls();

    function init() {
        const list = document.getElementById('profile-list');
        db_accs.forEach((a, i) => {
            list.innerHTML += `<div onclick="login(${i})" style="cursor:pointer; text-align:center;"><div style="width:80px;height:80px;border-radius:50%;background:${a.color};display:flex;align-items:center;justify-content:center;font-size:30px;">${a.name[0]}</div><p>${a.name}</p></div>`;
        });
    }

    function login(i) {
        let p = prompt("MDP :");
        if(p === db_accs[i].mdp) {
            user = db_accs[i];
            document.getElementById('profile-selector').style.display = 'none';
            if(user.role === 'admin') document.getElementById('admin-link').style.display = 'block';
            document.getElementById('user-info').innerText = "Bonjour, " + user.name;
            updateFolderSelect();
            render();
        }
    }

    // GESTION LECTEUR
    function toggleView() {
        const wrap = document.getElementById('player-wrap');
        wrap.classList.toggle('mode-mini');
        wrap.classList.toggle('mode-full');
    }

    function play(url) {
        if(url.includes('.m3u8')) {
            hls.loadSource(url); hls.attachMedia(player); player.play();
        } else { player.src = url; player.play(); }
    }

    // ADMIN ACTIONS
    function addFolder() {
        let n = document.getElementById('folder-name').value;
        if(n) { db_folders.push(n.toUpperCase()); save(); updateFolderSelect(); render(); }
    }

    function updateFolderSelect() {
        const sel = document.getElementById('c-folder');
        const adminF = document.getElementById('admin-folders');
        sel.innerHTML = ''; adminF.innerHTML = '';
        db_folders.forEach((f, i) => {
            sel.innerHTML += `<option value="${f}">${f}</option>`;
            adminF.innerHTML += `<div class="admin-item">${f} <button onclick="delFolder(${i})" style="color:red;background:none;border:none;">X</button></div>`;
        });
    }

    function addChannel() {
        let n = document.getElementById('c-name').value;
        let u = document.getElementById('c-url').value;
        let l = document.getElementById('c-logo').value;
        let f = document.getElementById('c-folder').value;
        let t = document.getElementById('c-type').value;
        if(n && u) {
            db_lib.push({name:n, url:u, logo:l, folder:f, type:t});
            save(); render();
        }
    }

    // TRI MANUEL
    function move(index, dir) {
        if(dir === 'up' && index > 0) [db_lib[index], db_lib[index-1]] = [db_lib[index-1], db_lib[index]];
        if(dir === 'down' && index < db_lib.length-1) [db_lib[index], db_lib[index+1]] = [db_lib[index+1], db_lib[index]];
        save(); render();
    }

    function delChan(i) { if(confirm("Supprimer ?")) { db_lib.splice(i, 1); save(); render(); } }
    function delFolder(i) { db_folders.splice(i,1); save(); updateFolderSelect(); render(); }

    function save() {
        localStorage.setItem('bj_accs', JSON.stringify(db_accs));
        localStorage.setItem('bj_lib', JSON.stringify(db_lib));
        localStorage.setItem('bj_folders', JSON.stringify(db_folders));
    }

    // RENDU ACCUEIL
    function render() {
        const main = document.getElementById('main-content');
        const filters = document.getElementById('folder-filters');
        const search = document.getElementById('search').value.toLowerCase();
        const adminList = document.getElementById('admin-channels-list');
        
        main.innerHTML = ''; filters.innerHTML = '<button class="cat-btn" onclick="scrollToGroup(\'all\')">TOUT</button>';
        adminList.innerHTML = '';

        db_folders.forEach(folder => {
            const filtered = db_lib.filter(c => c.folder === folder && c.name.toLowerCase().includes(search));
            if(filtered.length > 0) {
                filters.innerHTML += `<button class="cat-btn" onclick="scrollToGroup('${folder}')">${folder}</button>`;
                let section = `<div id="sec-${folder}"><h2 class="group-title">${folder}</h2><div class="grid">`;
                filtered.forEach(c => {
                    section += `<div class="card" onclick="play('${c.url}')"><img src="${c.logo}"><p>${c.name}</p></div>`;
                });
                section += `</div></div>`;
                main.innerHTML += section;
            }
        });

        // Liste admin pour tri
        db_lib.forEach((c, i) => {
            adminList.innerHTML += `<div class="admin-item">
                <span>[${c.folder}] ${c.name}</span>
                <div>
                    <button class="btn-move" onclick="move(${i}, 'up')">‚ñ≤</button>
                    <button class="btn-move" onclick="move(${i}, 'down')">‚ñº</button>
                    <button onclick="delChan(${i})" style="color:red;background:none;border:none;margin-left:10px;">X</button>
                </div>
            </div>`;
        });
    }

    function scrollToGroup(id) {
        if(id === 'all') window.scrollTo({top: 400, behavior: 'smooth'});
        else document.getElementById('sec-'+id).scrollIntoView({behavior: 'smooth', block: 'center'});
    }

    function showPage(id) {
        document.getElementById('page-home').style.display = (id === 'home') ? 'block' : 'none';
        document.getElementById('page-account').style.display = (id === 'account') ? 'block' : 'none';
        document.getElementById('page-admin').style.display = (id === 'admin') ? 'block' : 'none';
    }

    function updateP() {
        let p = document.getElementById('new-p').value;
        if(p) { user.mdp = p; save(); alert("Fait"); }
    }

    init();
</script>
</body>
</html>
