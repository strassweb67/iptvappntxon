<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TV_NTX | High-End Stream</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --ntx-red: #e50914; --bg: #000; --card: #121212; --border: rgba(255,255,255,0.08); }
        
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
        body, html { 
            margin: 0; padding: 0; background: var(--bg); color: #fff; 
            font-family: 'Inter', sans-serif; overflow-x: hidden; width: 100%;
        }

        /* NAVIGATION FIXE */
        nav { 
            position: fixed; top: 0; width: 100%; height: 65px; 
            display: flex; align-items: center; padding: 0 5%; 
            z-index: 1000; background: rgba(0,0,0,0.9); 
            border-bottom: 1px solid var(--border); backdrop-filter: blur(10px);
        }
        .logo { font-weight: 900; font-size: 24px; color: var(--ntx-red); letter-spacing: -1.5px; }
        .nav-links { margin-left: auto; display: flex; gap: 20px; }
        .nav-link { font-size: 13px; font-weight: 700; cursor: pointer; color: #888; text-transform: uppercase; transition: 0.3s; }
        .nav-link.active { color: #fff; }
        .nav-link-adm { color: var(--ntx-red) !important; border: 1px solid var(--ntx-red); padding: 4px 10px; border-radius: 4px; }

        /* CONTENEUR PRINCIPAL */
        .main-content { max-width: 1400px; margin: 0 auto; padding: 85px 5% 40px; }

        /* LECTEUR VIDEO */
        .player-section { width: 100%; aspect-ratio: 16/9; background: #000; border-radius: 12px; overflow: hidden; border: 1px solid var(--border); box-shadow: 0 10px 40px rgba(0,0,0,0.8); }
        video { width: 100%; height: 100%; display: block; }
        .now-playing { margin-top: 15px; font-weight: 700; color: var(--ntx-red); font-size: 14px; text-transform: uppercase; }

        /* FILTRE CATEGORIES */
        .filter-wrap { margin: 25px 0; }
        .cat-select { 
            background: #111; color: #fff; border: 1px solid #333; padding: 12px 20px; 
            border-radius: 8px; width: 100%; max-width: 320px; font-weight: 600; cursor: pointer; outline: none;
        }

        /* GRILLE DE CHAINES */
        .row-title { font-size: 20px; font-weight: 800; margin: 35px 0 15px; text-transform: uppercase; letter-spacing: 0.5px; border-left: 4px solid var(--ntx-red); padding-left: 12px; }
        .row-scroll { display: flex; gap: 15px; overflow-x: auto; padding-bottom: 20px; scrollbar-width: none; }
        .row-scroll::-webkit-scrollbar { display: none; }
        .card { 
            min-width: 220px; width: 220px; aspect-ratio: 16/9; background: var(--card); 
            border: 1px solid var(--border); border-radius: 8px; cursor: pointer; 
            transition: transform 0.3s, border-color 0.3s; overflow: hidden; position: relative;
        }
        .card:hover { transform: scale(1.04); border-color: var(--ntx-red); }
        .card img { width: 100%; height: 100%; object-fit: contain; padding: 15px; }

        /* PANNEAU ADMIN */
        .admin-page { display: none; padding: 85px 5% 50px; max-width: 900px; margin: 0 auto; }
        .box { background: #0a0a0a; padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 1px solid #222; }
        .box h3 { margin-top: 0; color: #fff; font-size: 18px; margin-bottom: 20px; }
        
        .ntx-input { 
            width: 100%; padding: 14px; background: #111; border: 1px solid #333; 
            color: #fff; border-radius: 8px; margin-bottom: 12px; font-size: 15px; outline: none;
        }
        .ntx-btn { 
            width: 100%; padding: 15px; background: var(--ntx-red); color: #fff; 
            border: none; border-radius: 8px; font-weight: 800; cursor: pointer; text-transform: uppercase;
        }

        /* LISTES ADMIN */
        .adm-item { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 12px; border-bottom: 1px solid #1a1a1a; gap: 10px; font-size: 14px;
        }
        .adm-actions { display: flex; gap: 5px; }
        .btn-mini { padding: 6px 10px; background: #222; border: 1px solid #444; color: #fff; border-radius: 4px; cursor: pointer; }
        .btn-del { color: #ff4444; border-color: #522; }

        /* RESPONSIVE TELEPHONE */
        @media (max-width: 768px) {
            .card { min-width: 160px; width: 160px; }
            .row-title { font-size: 17px; }
            .nav-link { font-size: 11px; }
            .adm-item { flex-direction: column; align-items: flex-start; }
            .adm-actions { width: 100%; justify-content: flex-end; }
        }
    </style>
</head>
<body>

<nav>
    <div class="logo">TV_NTX</div>
    <div class="nav-links">
        <span class="nav-link active" id="tab-home" onclick="showSection('home')">Accueil</span>
        <span class="nav-link nav-link-adm" id="tab-admin" onclick="showSection('admin')">Admin</span>
    </div>
</nav>

<div id="sec-home" class="main-content">
    <div class="player-section">
        <video id="player" controls playsinline></video>
    </div>
    <div id="playing-title" class="now-playing">Aucune chaîne en cours</div>

    <div class="filter-wrap">
        <select id="cat-filter" class="cat-select" onchange="renderHome()">
            </select>
    </div>

    <div id="mount-point"></div>
</div>

<div id="sec-admin" class="admin-page">
    <div class="box">
        <h3>Créer un Dossier (Catégorie)</h3>
        <div style="display:flex; gap:10px;">
            <input type="text" id="in-cat-name" class="ntx-input" style="margin:0" placeholder="Ex: Sport, Cinéma...">
            <button class="ntx-btn" style="width:120px" onclick="addCategory()">Créer</button>
        </div>
        <div id="list-cats" style="margin-top:15px;"></div>
    </div>

    <div class="box">
        <h3>Ajouter une Chaîne</h3>
        <input type="text" id="in-ch-name" class="ntx-input" placeholder="Nom de la chaîne">
        <input type="text" id="in-ch-url" class="ntx-input" placeholder="Lien Flux (m3u8)">
        <input type="text" id="in-ch-logo" class="ntx-input" placeholder="Lien Logo PNG (Optionnel)">
        <select id="in-ch-cat" class="ntx-input"></select>
        <button class="ntx-btn" onclick="addChannel()">Ajouter au catalogue</button>
        <div id="list-chans" style="margin-top:20px;"></div>
    </div>
</div>

<script>
    // STOCKAGE LOCAL
    let categories = JSON.parse(localStorage.getItem('ntx_cats')) || ["TNT", "FILMS"];
    let channels = JSON.parse(localStorage.getItem('ntx_chans')) || [];

    // INITIALISATION
    window.onload = () => {
        refreshUI();
    };

    function refreshUI() {
        renderHomeSelect();
        renderHome();
        renderAdminCats();
        renderAdminChans();
    }

    // --- ACCUEIL ---
    function renderHomeSelect() {
        const sel = document.getElementById('cat-filter');
        sel.innerHTML = '<option value="ALL">TOUTES LES CATÉGORIES</option>';
        categories.forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
    }

    function renderHome() {
        const mount = document.getElementById('mount-point');
        const filter = document.getElementById('cat-filter').value;
        mount.innerHTML = '';

        const activeCats = filter === 'ALL' ? categories : [filter];

        activeCats.forEach(cat => {
            const chs = channels.filter(x => x.cat === cat);
            if(chs.length > 0) {
                let html = `<div class="row-title">${cat}</div><div class="row-scroll">`;
                chs.forEach(ch => {
                    html += `<div class="card" onclick="play('${ch.url}', '${ch.name}')">
                        <img src="${ch.logo || 'https://via.placeholder.com/300x168/111/333?text='+ch.name}">
                    </div>`;
                });
                html += `</div>`;
                mount.innerHTML += html;
            }
        });
    }

    const hls = new Hls();
    function play(url, name) {
        const video = document.getElementById('player');
        document.getElementById('playing-title').innerText = "DIRECT : " + name;
        if (Hls.isSupported()) {
            hls.loadSource(url);
            hls.attachMedia(video);
            hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
        } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
            video.src = url;
            video.play();
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    // --- ADMIN ---
    function addCategory() {
        const val = document.getElementById('in-cat-name').value.trim();
        if(val && !categories.includes(val)) {
            categories.push(val);
            saveAndRefresh();
            document.getElementById('in-cat-name').value = '';
        }
    }

    function addChannel() {
        const name = document.getElementById('in-ch-name').value.trim();
        const url = document.getElementById('in-ch-url').value.trim();
        const logo = document.getElementById('in-ch-logo').value.trim();
        const cat = document.getElementById('in-ch-cat').value;
        if(name && url) {
            channels.push({ name, url, logo, cat });
            saveAndRefresh();
            document.getElementById('in-ch-name').value = '';
            document.getElementById('in-ch-url').value = '';
        }
    }

    function renderAdminCats() {
        const list = document.getElementById('list-cats');
        list.innerHTML = '';
        categories.forEach((c, i) => {
            list.innerHTML += `<div class="adm-item"><span>${c}</span>
            <button class="btn-mini btn-del" onclick="removeCat(${i})">Supprimer</button></div>`;
        });
        // Sync select
        const sel = document.getElementById('in-ch-cat');
        sel.innerHTML = '';
        categories.forEach(c => sel.innerHTML += `<option value="${c}">${c}</option>`);
    }

    function renderAdminChans() {
        const list = document.getElementById('list-chans');
        list.innerHTML = '<h4>Gérer mes chaînes :</h4>';
        channels.forEach((ch, i) => {
            list.innerHTML += `<div class="adm-item">
                <span><b>[${ch.cat}]</b> ${ch.name}</span>
                <div class="adm-actions">
                    <button class="btn-mini" onclick="moveCh(${i}, -1)">↑</button>
                    <button class="btn-mini" onclick="moveCh(${i}, 1)">↓</button>
                    <button class="btn-mini btn-del" onclick="removeCh(${i})">X</button>
                </div>
            </div>`;
        });
    }

    function removeCat(i) { categories.splice(i, 1); saveAndRefresh(); }
    function removeCh(i) { channels.splice(i, 1); saveAndRefresh(); }
    function moveCh(idx, dir) {
        let t = idx + dir;
        if(t >= 0 && t < channels.length) {
            [channels[idx], channels[t]] = [channels[t], channels[idx]];
            saveAndRefresh();
        }
    }

    function saveAndRefresh() {
        localStorage.setItem('ntx_cats', JSON.stringify(categories));
        localStorage.setItem('ntx_chans', JSON.stringify(channels));
        refreshUI();
    }

    function showSection(id) {
        document.getElementById('sec-home').style.display = (id === 'home' ? 'block' : 'none');
        document.getElementById('sec-admin').style.display = (id === 'admin' ? 'block' : 'none');
        document.getElementById('tab-home').classList.toggle('active', id === 'home');
        document.getElementById('tab-admin').classList.toggle('active', id === 'admin');
    }
</script>

</body>
</html>
