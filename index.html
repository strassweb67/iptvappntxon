<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>TV_NTX | Premium Streaming Platform</title>
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;700;900&display=swap" rel="stylesheet">
    <style>
        :root { --ntx-red: #e50914; --bg: #000; --card: #181818; --glass: rgba(0,0,0,0.85); --text: #ffffff; }
        
        * { box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
        body, html { margin: 0; padding: 0; background: var(--bg); color: var(--text); font-family: 'Inter', sans-serif; overflow-x: hidden; height: 100%; }

        /* --- PAGE D'ACCUEIL CINÉMATIQUE --- */
        #welcome-screen {
            position: fixed; inset: 0; z-index: 10000; display: flex; flex-direction: column;
            justify-content: center; align-items: center; background: #000; overflow: hidden;
        }
        #bg-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; opacity: 0.6; pointer-events: none; }
        .welcome-content { position: relative; z-index: 10; text-align: center; width: 90%; max-width: 450px; }
        .logo-pulse { 
            font-size: 60px; font-weight: 900; color: var(--ntx-red); letter-spacing: -4px;
            animation: pulse 2s infinite alternate; margin-bottom: 30px; 
        }
        @keyframes pulse { from { transform: scale(1); opacity: 1; text-shadow: 0 0 10px rgba(229,9,20,0.5); } to { transform: scale(1.05); opacity: 0.8; text-shadow: 0 0 30px rgba(229,9,20,0.8); } }
        
        .pin-container { background: var(--glass); padding: 30px; border-radius: 20px; border: 1px solid rgba(255,255,255,0.1); backdrop-filter: blur(20px); }
        .pin-input { 
            width: 100%; background: #111; border: 1px solid #333; color: #fff; 
            padding: 15px; font-size: 24px; text-align: center; border-radius: 10px; 
            margin-bottom: 15px; letter-spacing: 5px; font-weight: 700;
        }
        .price-tag { font-size: 12px; color: #888; margin-bottom: 20px; }
        .by-brice { font-size: 14px; font-weight: 600; color: var(--ntx-red); margin-top: 20px; }

        /* --- INTERFACE PRINCIPALE --- */
        #main-interface { display: none; padding-top: 70px; }
        header { 
            position: fixed; top: 0; width: 100%; height: 70px; background: linear-gradient(to bottom, #000, transparent);
            display: flex; align-items: center; padding: 0 4%; z-index: 9000; backdrop-filter: blur(10px);
        }
        .nav-btn { color: #aaa; margin-left: 20px; cursor: pointer; font-weight: 700; font-size: 14px; text-transform: uppercase; }
        .nav-btn:hover, .nav-btn.active { color: #fff; }
        .nav-admin { color: var(--ntx-red) !important; border: 1px solid var(--ntx-red); padding: 5px 15px; border-radius: 5px; }

        /* --- PLAYER --- */
        .player-container { width: 100%; max-width: 1400px; margin: 0 auto; padding: 0 4%; }
        .player-wrapper { 
            position: relative; width: 100%; aspect-ratio: 16/9; background: #000; 
            border-radius: 15px; overflow: hidden; border: 1px solid rgba(255,255,255,0.1);
        }
        video { width: 100%; height: 100%; }
        .quality-btn { position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.7); border: 1px solid #444; color: #fff; padding: 5px 10px; border-radius: 5px; font-size: 12px; cursor: pointer; }

        /* --- CATEGORIES & RAILS --- */
        .rail { margin: 30px 0; padding: 0 4%; }
        .rail-title { font-size: 22px; font-weight: 800; margin-bottom: 15px; text-transform: capitalize; }
        .rail-items { display: flex; gap: 15px; overflow-x: auto; scrollbar-width: none; padding-bottom: 15px; }
        .rail-items::-webkit-scrollbar { display: none; }
        .card { 
            min-width: 240px; aspect-ratio: 16/9; background: var(--card); border-radius: 8px; 
            cursor: pointer; transition: transform 0.3s; border: 1px solid #222; overflow: hidden; position: relative;
        }
        .card:hover { transform: scale(1.05); border-color: var(--ntx-red); z-index: 5; }
        .card img { width: 100%; height: 100%; object-fit: contain; padding: 15px; }
        .card-label { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(transparent, #000); padding: 10px; font-size: 12px; font-weight: 700; }

        /* --- ADMIN PANEL --- */
        #admin-panel { display: none; padding: 40px 4%; max-width: 1000px; margin: 0 auto; }
        .box { background: #111; padding: 25px; border-radius: 15px; margin-bottom: 25px; border: 1px solid #222; }
        .ntx-input { width: 100%; background: #000; border: 1px solid #333; color: #fff; padding: 12px; border-radius: 8px; margin-bottom: 10px; }
        .ntx-btn { width: 100%; background: var(--ntx-red); color: #fff; border: none; padding: 15px; border-radius: 8px; font-weight: 800; cursor: pointer; margin-top: 10px; }
        .adm-list-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #222; font-size: 14px; }
        .move-btns button { background: #333; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; }

        footer { text-align: center; padding: 40px; color: #444; font-size: 12px; }
    </style>
</head>
<body>

<div id="welcome-screen">
    <video id="bg-video" autoplay muted loop playsinline>
        <source src="https://assets.mixkit.co/videos/preview/mixkit-action-movie-trailer-with-intense-scenes-34651-large.mp4" type="video/mp4">
    </video>
    
    <div class="welcome-content">
        <div class="logo-pulse" id="main-logo">TV_NTX</div>
        <div class="pin-container">
            <h2 style="margin-top:0; font-size: 18px;">ENTRER VOTRE CODE D'ACCÈS</h2>
            <input type="password" id="pin-entry" class="pin-input" maxlength="8" placeholder="****">
            <button class="ntx-btn" onclick="checkPin()">VALIDER L'ACCÈS</button>
            <div class="price-tag">
                OFFRE PREMIUM : 9.99€/mois - UHD & 4K Inclus<br>
                <span class="by-brice">@By brice jct.</span>
            </div>
        </div>
    </div>
</div>

<div id="main-interface">
    <header>
        <div class="logo-pulse" style="font-size: 24px; margin: 0;">TV_NTX</div>
        <div class="nav-btn active" onclick="showUI('home')">Accueil</div>
        <div class="nav-btn" onclick="showUI('tv')">TV Direct</div>
        <div class="nav-btn" onclick="showUI('vod')">Films & Séries</div>
        <div class="nav-btn" onclick="showUI('radio')">Musique & Radio</div>
        <div class="nav-btn nav-admin" id="admin-link" style="display:none;" onclick="showUI('admin')">PANEL ADMIN</div>
        <div class="nav-btn" style="margin-left: auto;" onclick="location.reload()">Quitter</div>
    </header>

    <div class="player-container">
        <div class="player-wrapper">
            <video id="video-player" controls playsinline></video>
            <select class="quality-btn" id="quality-selector" onchange="changeQuality()">
                <option value="auto">Auto (4K Ready)</option>
                <option value="2160">4K UHD</option>
                <option value="1080">1080p FHD</option>
                <option value="720">720p HD</option>
            </select>
        </div>
        <h1 id="current-title" style="margin: 20px 0 5px; font-weight: 900;">TF1 HD</h1>
        <p id="current-tags" style="color: var(--ntx-red); font-weight: 700; margin: 0; font-size: 14px;">#DIRECT #TNT</p>
    </div>

    <div id="dynamic-rails"></div>

    <div id="admin-panel">
        <div class="box">
            <h3>AJOUTER DU CONTENU (TV / FILM / RADIO)</h3>
            <select id="add-type" class="ntx-input">
                <option value="tv">TV Direct (M3U8)</option>
                <option value="vod">Film / Série (MP4)</option>
                <option value="radio">Radio / Musique</option>
            </select>
            <input type="text" id="add-name" class="ntx-input" placeholder="Nom du contenu">
            <input type="text" id="add-url" class="ntx-input" placeholder="URL du flux (.m3u8 ou .mp4)">
            <input type="text" id="add-logo" class="ntx-input" placeholder="URL de l'image (Lien direct)">
            <input type="text" id="add-tags" class="ntx-input" placeholder="Tags (ex: Action, Sport, National) - Séparés par virgule">
            <button class="ntx-btn" onclick="saveContent()">ENREGISTRER SUR LE SERVEUR</button>
        </div>

        <div class="box">
            <h3>GESTION DES ACCÈS CODES</h3>
            <input type="text" id="new-client-code" class="ntx-input" placeholder="Nouveau Code Client">
            <input type="date" id="new-client-exp" class="ntx-input">
            <button class="ntx-btn" style="background: #333;" onclick="addClient()">CRÉER ACCÈS CLIENT</button>
            <div id="client-list" style="margin-top:15px;"></div>
        </div>

        <div class="box">
            <h3>ORGANISATION DU CATALOGUE</h3>
            <div id="catalog-list"></div>
        </div>
    </div>

    <footer>
        <p>@By brice jct. - Tous droits réservés.</p>
        <p>Plateforme de diffusion sécurisée TV_NTX v4.0 Evolution</p>
    </footer>
</div>

<script>
    // --- BASE DE DONNÉES INITIALE ---
    const hls = new Hls();
    let contentDB = JSON.parse(localStorage.getItem('ntx_content')) || [
        { 
            name: "TF1 HD", 
            url: "https://viamotionhsi.netplus.ch/live/eds/tf1hd/browser-HLS8/tf1hd.m3u8", 
            logo: "https://raw.githubusercontent.com/tv-logo/tv-logos/main/countries/france/tf1-fr.png", 
            tags: "TNT, National", 
            type: "tv" 
        }
    ];

    let clientsDB = JSON.parse(localStorage.getItem('ntx_clients')) || [
        { pin: "Treza670", role: "admin", exp: null },
        { pin: "1234", role: "user", exp: "2026-12-31" }
    ];

    // --- LOGIQUE D'ACCÈS ---
    function checkPin() {
        const pin = document.getElementById('pin-entry').value;
        const user = clientsDB.find(u => u.pin === pin);

        if (user) {
            if (user.exp && new Date(user.exp) < new Date()) {
                alert("Votre accès a expiré. Contactez Brice @By brice jct.");
                return;
            }
            document.getElementById('welcome-screen').style.display = 'none';
            document.getElementById('main-interface').style.display = 'block';
            if (user.role === 'admin') document.getElementById('admin-link').style.display = 'block';
            renderUI();
        } else {
            alert("Code incorrect.");
        }
    }

    // --- MOTEUR DE TAGS & RENDU ---
    function renderUI(filterType = 'home') {
        const mount = document.getElementById('dynamic-rails');
        mount.innerHTML = '';
        
        // Extraction de tous les tags uniques
        let allTags = [];
        contentDB.forEach(item => {
            if(filterType !== 'home' && item.type !== filterType) return;
            let tags = item.tags.split(',').map(t => t.trim());
            allTags = [...new Set([...allTags, ...tags])];
        });

        // Création d'un rail par Tag
        allTags.forEach(tag => {
            const itemsInTag = contentDB.filter(item => {
                if(filterType !== 'home' && item.type !== filterType) return false;
                return item.tags.includes(tag);
            });

            if (itemsInTag.length > 0) {
                let railHtml = `
                    <div class="rail">
                        <div class="rail-title">${tag}</div>
                        <div class="rail-items">
                `;

                itemsInTag.forEach(item => {
                    railHtml += `
                        <div class="card" onclick="loadVideo('${item.url}', '${item.name}', '${item.tags}')">
                            <img src="${item.logo}" onerror="this.src='https://via.placeholder.com/300x168/111/fff?text=${item.name}'">
                            <div class="card-label">${item.name}</div>
                        </div>
                    `;
                });

                railHtml += `</div></div>`;
                mount.innerHTML += railHtml;
            }
        });
        renderCatalogAdmin();
        renderClientsAdmin();
    }

    // --- LECTEUR & QUALITÉ ---
    function loadVideo(url, name, tags) {
        document.getElementById('current-title').innerText = name;
        document.getElementById('current-tags').innerText = tags.split(',').map(t => '#' + t.trim().toUpperCase()).join(' ');
        
        const video = document.getElementById('video-player');
        if (url.endsWith('.m3u8')) {
            if (Hls.isSupported()) {
                hls.loadSource(url);
                hls.attachMedia(video);
                hls.on(Hls.Events.MANIFEST_PARSED, () => video.play());
            }
        } else {
            video.src = url;
            video.play();
        }
        window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function changeQuality() {
        const q = document.getElementById('quality-selector').value;
        alert("Qualité ajustée sur : " + (q === 'auto' ? 'Adaptative 4K' : q + 'p'));
        // Sur HLS.js, on pourrait forcer le level, ici on simule l'UI demandée
    }

    // --- ACTIONS ADMIN ---
    function saveContent() {
        const newItem = {
            type: document.getElementById('add-type').value,
            name: document.getElementById('add-name').value,
            url: document.getElementById('add-url').value,
            logo: document.getElementById('add-logo').value,
            tags: document.getElementById('add-tags').value
        };
        if(newItem.name && newItem.url) {
            contentDB.push(newItem);
            localStorage.setItem('ntx_content', JSON.stringify(contentDB));
            renderUI();
            alert("Contenu ajouté !");
        }
    }

    function renderCatalogAdmin() {
        const list = document.getElementById('catalog-list');
        list.innerHTML = '<h4>Gestion du Catalogue</h4>';
        contentDB.forEach((item, i) => {
            list.innerHTML += `
                <div class="adm-list-item">
                    <span><b>[${item.type.toUpperCase()}]</b> ${item.name}</span>
                    <div class="move-btns">
                        <button onclick="moveItem(${i}, -1)">↑</button>
                        <button onclick="moveItem(${i}, 1)">↓</button>
                        <button style="background:red" onclick="deleteItem(${i})">X</button>
                    </div>
                </div>
            `;
        });
    }

    function moveItem(idx, dir) {
        let t = idx + dir;
        if(t >= 0 && t < contentDB.length) {
            [contentDB[idx], contentDB[t]] = [contentDB[t], contentDB[idx]];
            localStorage.setItem('ntx_content', JSON.stringify(contentDB));
            renderUI();
        }
    }

    function deleteItem(i) {
        contentDB.splice(i, 1);
        localStorage.setItem('ntx_content', JSON.stringify(contentDB));
        renderUI();
    }

    function addClient() {
        const pin = document.getElementById('new-client-code').value;
        const exp = document.getElementById('new-client-exp').value;
        if(pin) {
            clientsDB.push({ pin, role: 'user', exp });
            localStorage.setItem('ntx_clients', JSON.stringify(clientsDB));
            renderClientsAdmin();
        }
    }

    function renderClientsAdmin() {
        const list = document.getElementById('client-list');
        list.innerHTML = '<h4>Codes Clients Actifs</h4>';
        clientsDB.forEach((c, i) => {
            if(c.role === 'admin') return;
            list.innerHTML += `<div class="adm-list-item">
                <span>Code: <b>${c.pin}</b> | Exp: ${c.exp || 'Illimité'}</span>
                <button style="background:red; color:white; border:none; padding:5px;" onclick="clientsDB.splice(${i},1); localStorage.setItem('ntx_clients', JSON.stringify(clientsDB)); renderClientsAdmin();">Supprimer</button>
            </div>`;
        });
    }

    function showUI(type) {
        document.getElementById('admin-panel').style.display = (type === 'admin' ? 'block' : 'none');
        if(type !== 'admin') {
            document.getElementById('main-interface').style.display = 'block';
            renderUI(type);
        }
    }
</script>
</body>
</html>
